<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0"
       xmlns:cxf="http://camel.apache.org/schema/blueprint/cxf"
       xsi:schemaLocation="
       http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
        http://camel.apache.org/schema/blueprint/cxf http://camel.apache.org/schema/blueprint/cxf/camel-cxf.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">
 


  <camelContext xmlns="http://camel.apache.org/schema/blueprint" trace="false">
    <threadPool  poolSize="10" maxPoolSize="50" maxQueueSize="50" keepAliveTime="25" id="PBQCarRequestThread" threadName="CarPBQThread" rejectedPolicy="DiscardOldest" />
    <route id="CarProfessionalBaseRoute">
     <from uri="activemq:queue:PBQCarRequestQ" id="CarQuoteCommonReqQ">
      <description/>
    </from>
      <bean ref="PBQuoteListener" method="onMessage" id="PBCarQuoteReqBean"/>
      <process ref="CarQuoteRequestProcessor" id="CarQuoteRequestProcessor"/>
      <log message="Car Mapper Request :${body}"></log>
       <to pattern="InOut" uri="xpathmapper://xpathmapdata" id="CarQuoteRequestMapper"/>
       <log message="xpathmapper://xpathmapdata Response :${body}"></log>
	   <process ref="LobRequestProcessor" id="LobRequestProcessor"/>
       <to pattern="InOut" uri="webservconsumer://invoke" id="CARQUOTEURL"/>
       <log message="carQuote Response :${body}"></log>
       <process ref="PBQuoteResponseProcessor" id="PBCarQuoteResponseProcessor"/>
       <multicast id="PBCarQuoteResponseMSG" parallelProcessing="true">
       <pipeline>
      		      <log message="PBQ car quote carrier service response ${body}"></log>
				   <wireTap uri="activemqSecondary:queue:PBQCarResponseQ?includeSentJMSMessageID=true"/>
	      		 <to pattern="InOnly" uri="activemq:queue:PBQCarResponseQ?timeToLive=120000&amp;includeSentJMSMessageID=true"/>
     	</pipeline>
	      <pipeline>
	             <process ref="PBQuoteDBSender" id="PBCarQuoteDBSender"/> 
	      </pipeline>
    </multicast>
    </route>
  </camelContext>

</blueprint>
