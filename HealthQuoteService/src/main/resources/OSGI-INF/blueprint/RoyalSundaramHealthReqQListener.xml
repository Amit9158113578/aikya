<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
       xmlns:camel="http://camel.apache.org/schema/blueprint"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">
       
       <camelContext trace="false" streamCache="true" threadNamePattern="ROYALQUOREQ" id="RoyalSundaramHealthReqQContext" xmlns="http://camel.apache.org/schema/blueprint">
  <dataFormats>
    <xmljson forceTopLevelObject="true" skipWhitespace="true" trimSpaces="true" skipNamespaces="true" removeNamespacePrefixes="true" id="Royaljsonxml"/>
    <xmljson forceTopLevelObject="true" skipWhitespace="true" trimSpaces="true" skipNamespaces="true" removeNamespacePrefixes="true" id="Royalxmljson"/>
  </dataFormats>
  <onException>
    <exception>java.net.SocketTimeoutException</exception>
    <handled>
      <constant>true</constant>
    </handled>
    <log message="Royal Sundaram Health Quote service not responded within stipulated time frame"/>
    <process ref="ExceptionMQMSGProcessor" customId="true" id="RoyalHealthExceptionMQMSGProcessor"/>
    <to pattern="InOnly" uri="activemq:queue:RoyalSundaramHealthResQ?timeToLive=120000&amp;includeSentJMSMessageID=true"/>
  </onException>
  <onException>
    <exception>com.idep.healthquote.exception.processor.ExecutionTerminator</exception>
    <exception>java.lang.Exception</exception>
    <handled>
      <constant>true</constant>
    </handled>
    <log message="Royal Sundaram Health quote process terminated"/>
    <process ref="ExceptionMQMSGProcessor" customId="true" id="RoyalHealthExceptionMQMSGProcessor"/>
    <to pattern="InOnly" uri="activemq:queue:RoyalSundaramHealthResQ?timeToLive=120000&amp;includeSentJMSMessageID=true"/>
  </onException>
  <route id="RoyalSundaramHealthReqQListener">
    <from uri="activemq:queue:RoyalSundaramHealthReqQ" id="FromRoyalHealthReqQ">
      <description/>
    </from>
    <bean ref="P365HealthReqQListener" method="onMessage" id="RoyalHealthReqQBean"/>
    <process ref="HealthRequestQProcessor" id="RoyalHealthReqQProcessor"/>
    <process ref="HealthQuoteLoggerProcessor" id="RoyalQuoteLoggerProcessor1"/>
    <process ref="ExternalServiceReqProcessor" id="RoyalServiceReqProcessor"/>
    <log message="RoyalSundaram request after ExternalServiceReqProcessor : {body}"/>
    <process ref="HealthQuoteElderMemberDataProcessor" id="HealthQuoteElderMemberDataProcessor"/>
    <process ref="CarrierCityLoader" id="RoyalSundCarrierCityLoader"/>
    <to pattern="InOut" uri="xpathmapper://xpathmapdata" id="RoyalHealthReqMapper"/>
    <process ref="RoyalSundaramSumInsureReqProcessor" id="RoyalSundaramSumInsureReqProcessor" />
    <process ref="CarrierTransformReqCollector" id="CarrierTransformReqCollector"/>
    <unmarshal ref="Royaljsonxml" id="RoyalJSONTOXML"/>
    <process ref="XMLCharEmitter" id="RoyalXMLCharEmitter"/>
    <process ref="CarrierQuoteServiceReqLogger" id="RoyalHealthQuoteLoggerProcessor"/>
    <log message="RoyalSundaram request before WebServConsumer : {body}"/>
    <to pattern="InOut" uri="webservconsumer://invoke" id="RoyalHealthQUOTEURL"/>
    
    <process ref="XMLCharEmitter" id="RoyalXMLCharEmitter"/>
    <marshal ref="Royalxmljson" id="RoyalXMLTOJSON"/>
    <process ref="CarrierServiceResponseHnadler" id="RoyalHealthServiceResProcessor"/>
    <to pattern="InOut" uri="mapper://mapdata"/>
    <process ref="CalculateDOBMinMaxProcessor" id="RoyalMemberDOBProcessor"/>
    <process ref="PremiumRatioCalculateProcessor" id="ROYALPremiumRatioCalculateProcessor"/>
    <process ref="ExternalServiceResProcessor" id="RoyalHealthServiceFinalResProcessor"/>
    <process ref="HealthQuoteLoggerProcessor" id="RoyalQuoteLoggerProcessor2"/>
    <multicast id="RoyalHealthQuoteResponseMSG">
      <pipeline>
        <log message="request/response sent to save Royal Sundaram Health quote in database"/>
        <process ref="HealthQuoteDBSender" id="RoyalHealthQuoteDBSender"/>
        <to pattern="InOnly" uri="activemqSecondary:queue:HealthQuoteResultsQ"/>
        <process ref="HealthQuoteLoggerProcessor" id="RoyalQuoteLoggerProcessor3"/>
      </pipeline>
      <pipeline>
        <process ref="CarrierQuoteServiceResLogger" id="ROYALHealthCarrierQuoteServiceResLogger"/>
        <process ref="MQMsgProcessor" id="RoyalHlthMQMsgReqProcessor"/>
         <!-- <wireTap uri="activemqSecondary:queue:RoyalSundaramHealthResQ?includeSentJMSMessageID=true"/> -->
        <to pattern="InOnly" uri="activemq:queue:RoyalSundaramHealthResQ?timeToLive=120000&amp;includeSentJMSMessageID=true"/>
        <process ref="HealthQuoteLoggerProcessor" id="RoyalQuoteLoggerProcessor4"/>
      </pipeline>
    </multicast>
  </route>
</camelContext>

</blueprint>
       